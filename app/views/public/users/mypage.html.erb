<div class="container">
    <div class="d-flex justify-content-center my-3">
        <% if @flg == 'not_get' %>
            <span class="mx-2"><%= link_to '全店舗', users_mypage_path %></span>
            |
            <span class="mx-2"><%= link_to '獲得済み店舗', users_mypage_path(check_flg: 'got') %></span>
            |
            <span class="mx-2">未獲得店舗</span>
        <% elsif @flg == 'got' %>
            <span class="mx-2"><%= link_to '全店舗', users_mypage_path %></span>
            |
            <span class="mx-2">獲得済み店舗</span>
            |
            <span class="mx-2"><%= link_to '未獲得店舗', users_mypage_path(check_flg: 'not_get') %></span>
        <% else %>
            <span class="mx-2">全店舗</span>
            |
            <span class="mx-2"><%= link_to '獲得済み店舗', users_mypage_path(check_flg: 'got') %></span>
            |
            <span class="mx-2"><%= link_to '未獲得店舗', users_mypage_path(check_flg: 'not_get') %></span>
        <% end %>
    </div>
    <div id='map' class="my-4"></div>
</div>
<style>
#map{
    height: 450px;
}
</style>

<script>
    async function initMap(){
        map = new google.maps.Map(document.getElementById("map"),{
            // center: {lat: 35, lng: 135},
            // zoom: 15,
            mapTypeControl: false, // 地図・衛星写真の切り替え不要
            streetViewControl: false, // ストリートビュー不要
        });
        bounds = new google.maps.LatLngBounds();
        <% @shops.each do |shop| %>
            var position = {lat: <%= shop.latitude %>, lng: <%= shop.longitude %>};
            var road_number = "<%= shop.sticker.road_number.to_s.rjust(3, '0') %>"
            setMarker(map, position, road_number, "<%= shop.name %>");
            bounds.extend(position);
        <% end %>
        map.fitBounds(bounds,10);
    };

    function setMarker(map, position, road_number, shop_name) {
        marker = new google.maps.Marker({
            map: map,
            position: position,
            icon: {
                url : "/images/" + road_number + ".png",
                scaledSize: new google.maps.Size(20, 20), // 画像サイズ
            }
        });
        marker.addListener("click", function() {
            // 緯度・経度で Google Maps を開く
            var url = "https://www.google.com/maps/search/?api=1&query=" + encodeURIComponent(shop_name);

            window.open(url, '_blank');  // 新しいタブで開く
        });
    };
</script>
